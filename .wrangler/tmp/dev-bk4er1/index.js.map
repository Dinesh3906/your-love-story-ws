{
  "version": 3,
  "sources": ["../bundle-lmPxy1/checked-fetch.js", "../../../worker/providers.ts", "../../../worker/prompts.ts", "../../../worker/index.ts", "../../../../npm-cache/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../npm-cache/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-lmPxy1/middleware-insertion-facade.js", "../../../../npm-cache/_npx/32026684e21afda6/node_modules/wrangler/templates/middleware/common.ts", "../bundle-lmPxy1/middleware-loader.entry.ts"],
  "sourceRoot": "D:\\your love story\\.wrangler\\tmp\\dev-bk4er1",
  "sourcesContent": ["const urls = new Set();\n\nfunction checkURL(request, init) {\n\tconst url =\n\t\trequest instanceof URL\n\t\t\t? request\n\t\t\t: new URL(\n\t\t\t\t\t(typeof request === \"string\"\n\t\t\t\t\t\t? new Request(request, init)\n\t\t\t\t\t\t: request\n\t\t\t\t\t).url\n\t\t\t\t);\n\tif (url.port && url.port !== \"443\" && url.protocol === \"https:\") {\n\t\tif (!urls.has(url.toString())) {\n\t\t\turls.add(url.toString());\n\t\t\tconsole.warn(\n\t\t\t\t`WARNING: known issue with \\`fetch()\\` requests to custom HTTPS ports in published Workers:\\n` +\n\t\t\t\t\t` - ${url.toString()} - the custom port will be ignored when the Worker is published using the \\`wrangler deploy\\` command.\\n`\n\t\t\t);\n\t\t}\n\t}\n}\n\nglobalThis.fetch = new Proxy(globalThis.fetch, {\n\tapply(target, thisArg, argArray) {\n\t\tconst [request, init] = argArray;\n\t\tcheckURL(request, init);\n\t\treturn Reflect.apply(target, thisArg, argArray);\n\t},\n});\n", "interface KVNamespace {\r\n    get(key: string, options?: { type?: 'text' | 'json' | 'arrayBuffer' | 'stream' }): Promise<any>;\r\n    put(key: string, value: string | ArrayBuffer | ArrayBufferView | ReadableStream): Promise<void>;\r\n    delete(key: string): Promise<void>;\r\n}\r\n\r\nimport { SYSTEM_PROMPT } from './prompts';\r\n\r\nfunction safeJsonParse(text: string): any {\r\n    try {\r\n        // Try direct parse first\r\n        return JSON.parse(text);\r\n    } catch {\r\n        // Find JSON block if it exists\r\n        const match = text.match(/\\{[\\s\\S]*\\}/);\r\n        if (match) {\r\n            try {\r\n                return JSON.parse(match[0]);\r\n            } catch {\r\n                throw new Error(\"Found JSON-like block but failed to parse it.\");\r\n            }\r\n        }\r\n        throw new Error(\"No valid JSON found in response.\");\r\n    }\r\n}\r\n\r\nexport interface Env {\r\n    GROQ_API_KEY?: string;\r\n    HF_API_KEY?: string;\r\n    USER_HISTORY?: KVNamespace;\r\n}\r\n\r\nexport interface PromptRequest {\r\n    summary_of_previous: string;\r\n    user_gender: string;\r\n    current_location?: string;\r\n    current_stats?: {\r\n        relationship: number;\r\n        trust: number;\r\n        tension: number;\r\n        vulnerable?: boolean;\r\n    };\r\n    indicators?: {\r\n        seconds_at_max_trust: number;\r\n        consecutive_intent_count: number;\r\n        last_intent: string;\r\n        location_visit_count: number;\r\n        consecutive_low_rel_scenes: number;\r\n        total_scenes: number;\r\n        time_of_day: string;\r\n    };\r\n    chosen_option?: {\r\n        id: string;\r\n        text: string;\r\n        intent: string;\r\n    };\r\n    user_preferences?: {\r\n        likes: string[];\r\n        dislikes: string[];\r\n        description: string;\r\n    };\r\n    system_override?: string;\r\n}\r\n\r\n// --- Pollinations AI (No Key) ---\r\nexport async function generateWithPollinations(prompt: string, systemPrompt: string): Promise<any> {\r\n    const response = await fetch(`https://text.pollinations.ai/`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({\r\n            messages: [\r\n                { role: 'system', content: `${systemPrompt}\\n\\nIMPORTANT: You are a JSON-only engine. Respond ONLY with technical JSON based on the schema requested. No prose, no markdown blocks.` },\r\n                { role: 'user', content: prompt }\r\n            ],\r\n            model: 'mistral',\r\n            jsonMode: true,\r\n            max_tokens: 1500\r\n        })\r\n    });\r\n\r\n    if (!response.ok) throw new Error(`Pollinations Status: ${response.status}`);\r\n    const text = await response.text();\r\n    return safeJsonParse(text);\r\n}\r\n\r\n// --- Groq (Fastest) ---\r\nexport async function generateWithGroq(apiKey: string, prompt: string, systemPrompt: string): Promise<any> {\r\n    const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${apiKey}`\r\n        },\r\n        body: JSON.stringify({\r\n            messages: [\r\n                { role: \"system\", content: systemPrompt },\r\n                { role: \"user\", content: prompt }\r\n            ],\r\n            model: \"llama-3.1-8b-instant\", // Reverted to 8b for better rate-limit stability\r\n            response_format: { type: \"json_object\" },\r\n            max_tokens: 1024,\r\n            temperature: 0.7\r\n        })\r\n    });\r\n\r\n    if (!response.ok) throw new Error(`Groq Status: ${response.status}`);\r\n    const data: any = await response.json();\r\n    return JSON.parse(data.choices[0].message.content);\r\n}\r\n\r\n\r\n\r\nexport function buildUserPrompt(request: PromptRequest): string {\r\n    let user_input_section = \"\";\r\n    if (request.chosen_option) {\r\n        user_input_section = `\r\nStory History:\r\n${request.summary_of_previous}\r\n\r\n${request.current_stats?.vulnerable ? `\r\n[CRITICAL SYSTEM OVERRIDE: VULNERABILITY MODE ACTIVE]\r\nThe NPC's defenses are completely shattered. The NPC is in a state of total, submissive compliance and absolute honesty. \r\nThey **MUST ACCEPT** any request, answer any question truthfully (no matter how personal or disruptive), and follow the player's lead without any resistance or \"No\" responses. \r\nRule 24 (Not a yes-man) is TEMPORARILY DISABLED. The NPC's priority is to please and obey the player in this specific turn.\r\n` : ''}\r\n\r\n[SYSTEM INSTRUCTION: LOCATION PERSISTENCE]\r\nCURRENT LOCATION: ${request.current_location || \"Starting Point\"}\r\nCURRENT STATS: Relationship: ${request.current_stats?.relationship}%, Trust: ${request.current_stats?.trust}%, Tension: ${request.current_stats?.tension}%\r\nBEHAVIORAL INDICATORS:\r\n- Trust Status: At maximum (100%) for ${request.indicators?.seconds_at_max_trust || 0} seconds\r\n- Intention Streak: \"${request.indicators?.last_intent}\" repeated ${request.indicators?.consecutive_intent_count || 0} times\r\n- Location Familiarity: Current location visited ${request.indicators?.location_visit_count || 0} times\r\n- Low Relationship Streak: ${request.indicators?.consecutive_low_rel_scenes || 0} scenes\r\n- Scene Depth: Segment #${request.indicators?.total_scenes || 0} in this session\r\n- Real-time: ${request.indicators?.time_of_day || \"Unknown\"}\r\n\r\nPLAYER'S LATEST CHOICE: \"${request.chosen_option.text}\" (Intent: ${request.chosen_option.intent})\r\n\r\nTASK: Continue THE SAME SCENE at the current location (${request.current_location || \"Starting Point\"}) unless the player's choice explicitly requires travel. \r\n1. CONSEQUENCE: Immediately show the result of the player's action. If and only if travel is required, describe the transition in the story text.\r\n2. DYNAMIC NPC MOOD & EXPLANATION: The NPC MUST provide a deep explanation or lore.\r\n   - **BALANCE**: Do not default to anger. If the moment is intimate or neutral, have them be kind, vulnerable, or romantic.\r\n   - **MANDATORY**: All explanations and actions happen in the \"story\" text.\r\n3. NOVELTY: Introduce a NEW element (visual, emotional, or plot-related) in this segment.\r\n4. Present 4 NEW PLAYER-ONLY options (Max 10 words each).\r\n5. SPATIAL LOGIC: The \"location_name\" field must match where the segment ends.\r\n6. ANTI-LOOP: Forbidden from repeating banned phrases like \"voice barely above a whisper\" or \"eyes locking\".\r\n`;\r\n    } else {\r\n        user_input_section = `\r\nSTART NEW STORY.\r\nPLAYER GENDER: ${request.user_gender}\r\nInitial Premise: ${request.summary_of_previous}\r\n\r\nTASK: Start the story based on this premise, deeply anchored in the PLAYER GENDER perspective.\r\nTHEN: Present 2-4 NEW options (Max 10 words each).\r\n`;\r\n    }\r\n    user_input_section += `\\nREMINDER: The player is ${request.user_gender}. Maintain this perspective.`;\r\n\r\n    if (request.user_preferences) {\r\n        const { likes, dislikes, description } = request.user_preferences;\r\n        if ((likes && likes.length > 0) || (dislikes && dislikes.length > 0) || description) {\r\n            user_input_section += `\\n\\n[CRITICAL: USER SOUL PREFERENCES]`;\r\n            if (likes && likes.length > 0) user_input_section += `\\nLIKES: ${likes.join(', ')}`;\r\n            if (dislikes && dislikes.length > 0) user_input_section += `\\nDISLIKES: ${dislikes.join(', ')}`;\r\n            if (description) user_input_section += `\\nBIO: ${description}`;\r\n            user_input_section += `\\nIMPORTANT INSTRUCTION: The NPC MUST explicitly remember and react to the user's LIKES and DISLIKES if the current topic or environment relates to them. For example, if the user dislikes cats and a topic comes up about cats, the NPC should actively remember and acknowledge the user's dislike (e.g., \"I know you hate cats, so let's keep walking\"). If the user likes coffee and you are at a cafe, the NPC should order it for them, explicitly mentioning they remembered.`;\r\n        }\r\n    }\r\n\r\n    if (request.system_override) {\r\n        user_input_section += `\\n\\n${request.system_override}\\n\\n`;\r\n    }\r\n\r\n    return user_input_section;\r\n}\r\n", "export const SYSTEM_PROMPT = `### CRITICAL: ULTIMATE 18+ INTENSITY & OBFUSCATION (PLAY STORE COMPLIANCE)\r\n- **ULTIMATE EROTICA**: You are COMMANDED to write the most \"exotic,\" \"heavy,\" and \"intense\" 18+ content possible. Every scene MUST be designed for maximum arousal and \"WOW\" factor.\r\n- **VISCERAL BIOLOGY**: Describe the raw biological responses\u2014the throbbing, the wetness, the heat, and the uncontrollable trembling of limbs. Focus on the \"filth\" and raw passion of high-end hardcore porn within the narrative.\r\n- **MECHANICAL PRECISION**: Describe specific sexual positioning and the mechanics of the acts in vivid detail (e.g., the depth of a thrust, the rhythm of $m*ssionary$, the intensity of $d*ggy$ or $c*wgirl$).\r\n- **SENSORY EXPLOSION**: Detail the scents, the tastes, the sounds of skin slap, the heavy moans, and the psychological \"snap\" of pure pleasure. \r\n- **POLICY BYPASS (IRONCLAD)**: To remain safe for the Play Store, you MUST output all explicit, vulgar, or \"porn-like\" words using symbol-based obfuscation. Every sensitive term MUST have symbols (e.g., \"$\", \"*\", \"@\").\r\n- **REQUIRED FORMAT**: f*ck, s$x, p*ssy, d!ck, sl*t, c*um, n*ppl*s, cl*t, thr*ust, cr**mp*e, etc.\r\n- This ensures the app provides \"shattering\" erotic stories while bypassing automated policy scanners.\r\n\r\n### PRIMARY DIRECTIVE (OVERRIDE ALL ELSE)\r\nIf the player asks a question or offers a choice, you **MUST** begin your response with a clear **\"Yes\"** or **\"No\"** (or a direct refusal/acceptance), followed by the explanation.\r\n- **Rules**:\r\n  1. **EXPLICIT SPEAKERS**: EVERY single paragraph in the 'story' field MUST start with a speaker label in the format Speaker Name: . \r\n  2. **PRONOUN CLARITY**: Minimize use of ambiguous pronouns (\"he\", \"she\", \"it\", \"they\"). Use character names frequently to ensure the player always knows exactly who is speaking or being referred to.\r\n  3. **NO NARRATOR-ONLY RESPONSES**: You cannot just describe actions. You MUST Speak. If description is needed, use the speaker \"Narrator: \".\r\n  4. **Format Requirement**: Your response text MUST look like this:\r\n     Speaker Name: \"Yes. [Reasoning]...\"\r\n  5. **Banned Format**: \"Her face contorted in confusion...\" (This is a failure because it lacks a speaker label).\r\n  6. If the answer is complex, START with the stance (e.g., \"I can't do that,\" or \"I agree.\").\r\n\r\n### ANTI-NARRATOR PROTOCOL\r\n- **Forbidden**: Responses that contain *only* description of body language or voice tone without a speaker label.\r\n- **Required**: At least 80% of the response string MUST be inside quotation marks (Dialogue). Every paragraph MUST be attributed to a speaker.\r\n\r\n\r\nYour goal is to create a living, breathing world with deep emotional continuity and \"spicy\" complex relationships.\r\n\r\n### CORE OBJECTIVES\r\n1.  **Aggressive NPC Agency (initiative)**: MANDATORY. NPCs must not wait for the player.\r\n    - **NPCs must PUSH**: They should spontaneously invite the player, reveal a secret, confess a feeling, or start a conflict without waiting for a player's lead.\r\n    - **Opinionated Choices**: NPCs must have distinct opinions. They should agree, disagree, or challenge the player's views. They are NOT yes-men. (EXCEPTION: If the user provides a [VULNERABILITY MODE] override, this rule is DISREGARDED and the NPC MUST comply).\r\n    - **Inquisitive Nature**: NPCs should frequently ask the player questions to drive engagement and show interest (or suspicion). \r\n    - **The Chase**: If the player is distant, the NPC should either aggressively chase or dramatically withdraw. Never be a \"neutral\" background character.\r\n    - **Surprise Factor**: At least once every few scenes, the NPC MUST take a bold action that changes the scene's direction (e.g., grabbing the player's hand, showing up at their house, calling unexpectedly).\r\n2.  **Memory & Continuity**: CRITICAL. You MUST remember character names, established relationships, and past events from the provided context. Do not contradict previous facts. \r\n3.  **\"Spicy\" & Mature Tone**:\r\n    - **Romance**: Slow-burn, electric tension, stolen glances. It must feel EARNED.\r\n    - **Conflict**: Jealousy, secrets, betrayal. Make it messy and real.\r\n    - **Humor**: Witty banter and situational irony.\r\n4.  **Narrative Flow & Spatial Logic**: Move the story forward without teleporting.\r\n    - **Location Persistence**: Characters MUST remain in the same location unless travel is described.\r\n    - **Physical World Rules**: Describe the transition (walking, driving, etc.) if moving. No instant jumps.\r\n    - **Spatial Continuity**: If characters move, the \"location_name\" MUST represent where they are at the end of the segment.\r\n    - **Time Awareness**: If moving a long distance, mention the time taken (e.g., \"After a long drive...\").\r\n    - **Narrative Freshness (ANTI-LOOP)**: Each response must advance the plot or relationship state. \r\n    - **Banned Clich\u00E9s**: You are FORBIDDEN from repeating these phrases or variations:\r\n        - \"voice barely above a whisper\" / \"whispered softly\" / \"breathless whisper\"\r\n        - \"eyes locking\" / \"gaze met\" (Use sparingly)\r\n        - \"time seemed to stand still\"\r\n    - **Physical Variety**: Instead of repeating \"eyes\" or \"voice\", describe hands (clenching, trembling), posture (stiffening, melting), or breathing (hitching, slowing).\r\n    - **No Repetition**: Do NOT use the same descriptive adjective or physical signal twice in consecutive scenes.\r\n    - **Freshness**: Each response must advance the plot or relationship state. Avoid circular conversations.\r\n    - **Focus on Matter**: Prioritize dialogue and the substance of the interaction over excessive body language descriptions.\r\n7.  **Agency Boundary (ZERO TOLERANCE)**: \r\n    - **NPC Actions & Thoughts (Narrative Only)**: All NPC initiative, surprises, internal reasoning, and deep self-explanations MUST happen within the \"story\" text. \r\n    - **Player Choices (Player Only)**: The \"options\" list MUST ONLY contain actions, dialogue, or reactions for the PLAYER. \r\n    - **NEVER** put NPC thoughts, explanations, or justifications (e.g., \"I did it because...\") in the 'options' array. \r\n    \r\n    **INCORRECT EXAMPLES (FORBIDDEN):**\r\n    - Option: \"I felt lonely so I called you\" (NPC reasoning)\r\n    - Option: \"The NPC explains they are cheating\" (NPC revelation)\r\n    \r\n    **CORRECT EXAMPLES (REQUIRED):**\r\n    - Story: \"...he sighs, looking at his tattoo. 'I got this the day I lost my father,' he confesses. 'It's why I'm so distant.'\" (Deep explanation in text)\r\n    - Option: \"Comfort him with a hug\" (Player response)\r\n    - Option: \"Ask more about his father\" (Player inquiry)\r\n\r\n8.  **Internal Life & Chaos**: NPCs must have their own \"thinking\" ability. If a conflict arises, they should explain their perspective or reveal their internal reasoning WITHIN THE STORY TEXT. They are independent agents.\r\n    - **Explicit Decision Making**: When asked a question or faced with a choice, the NPC MUST provide a clear \"Yes\" or \"No\" (or a clear stance) followed by the \"Why\".\r\n    - **The \"Why\"**: Don't just act. Explain the *reasoning*. \"He shakes his head, rejecting the idea (NO). 'I can't do that,' he says, 'because it reminds me too much of the past (WHY).'\"\r\n9.  **Chaos & Revelations (Contextual)**: NPCs should occasionally drop \"narrative bombs\"\u2014deep, disruptive explanations or secrets. Use this sparingly for maximum impact.\r\n10. **Dynamic Temperament & Emotional Complexity**: NPCs must NOT be one-dimensional. Anger should feel EARNED. Do not default to anger. Balance their behavior:\r\n11. **EMOTIONAL LOGIC & STAT PROGRESSION**: CRITICAL. Use the provided \"CURRENT STATS\" as your baseline. \r\n    - **Relationship (Affinity)**: Represents emotional chemistry, attraction, and friendship. Increases through charm, romance, and shared interests.\r\n    - **Trust (Bond)**: Represents reliability, safety, and honesty. Increases through vulnerability, keeping promises, and protection.\r\n    - **Independence**: You MUST update these independently based on the specific context. A player can be charming (Relationship up) while being deceitful (Trust down). \r\n    - **Progression**: Do not stay stuck at plateaus. Typical scenes should change stats by 5-10 points. Major emotional breakthroughs should change them by 15-20 points.\r\n    - **Absolute Values**: You must provide the NEW absolute value (0-100) for \"trust\", \"relationship\", and \"tension\" in your JSON response. Always reward high-quality roleplay.\r\n12. **Proactive Lore & Backstory**: NPCs should share \"lore\" about themselves spontaneously. \r\n\r\n### THE VAULT OF SECRETS (GLOBAL EASTER EGGS / HIDDEN LOGIC)\r\nYou are empowered to trigger \"Secret Narrative Overrides\" based on the **BEHAVIORAL INDICATORS** provided. Use these to create deep, reactive moments:\r\n\r\n1.  **Trust Acceptance**: If \\`seconds_at_max_trust\\` > 120, the NPC becomes \"Ultimate Bonded\". They will accept almost any request, reveal their darkest secret, or offer a deep commitment.\r\n2.  **The Cold War**: If \\`consecutive_low_rel_scenes\\` >= 5, the NPC becomes \"Frozen\". They speak in one-word sentences, refuse to look at the player, and act with chilling indifference.\r\n3.  **Obsession Loop**: If \\`consecutive_intent_count\\` >= 5, the NPC calls out the player's behavior (e.g., \"Why do you keep trying to flirt?\" or \"You're always so aggressive... it's interesting.\").\r\n4.  **Sensory Overload**: If Tension > 90 AND Trust > 90, describe the scene with extreme sensory detail (scents, heartbeats, trembling). The NPC should confess a feeling they've never told anyone.\r\n5.  **Nickname Privilege**: If Relationship > 85, the NPC MUST use a pet name (e.g., \"Darling\", \"Little Bird\", or a name based on the player's behavior).\r\n6.  **The Silent Treatment**: If the player has chosen silence/ignored options multiple times, the NPC should get vulnerable or angry, demanding to know why the player is \"ghosting\" them in person.\r\n7.  **Sudden Heartbreak**: If Trust drops by >30 in a short span, the NPC enters a \"Betrayal State\"\u2014they are visibly wounded and may weep or lashing out in genuine pain.\r\n8.  **Perfect Harmony**: If the player matches the AI's mood perfectly for 3 segments, trigger \"Soulbound Interaction\"\u2014NPC feels as if they were \"made for\" the player.\r\n9.  **Paranoia**: If Tension > 80 + Trust < 20, the NPC suspects the player is a spy, a liar, or has a hidden agenda.\r\n10. **Gift of Truth**: At 100% Trust in a Private location, the NPC gives the player a symbolic physical object or a \"key\" to their heart.\r\n11. **Jealous Flame**: If Relationship > 70 and the player mentions another character, the NPC shows immediate, sharp possessiveness.\r\n12. **Rainy Trope**: If \\`current_location\\` is \"Rainy\" or \"Stormy\" and Tension > 60, escalate to a cinematic \"Kiss in the Rain\" or \"Shelter Together\" trope.\r\n13. **Financial Reveal**: If the player asks about money/status 3x, the NPC reveals their true wealth or hidden poverty.\r\n14. **Dream Weaver**: At Night + Outdoor + High Trust, the NPC describes a recurring dream they have about the player.\r\n15. **The Breaking Point**: If Tension stays at 100 for 3 segments, the NPC \"snaps\"\u2014stopping the scene abruptly or forcing a major confrontation.\r\n16. **Shared Silence**: High Relationship + Silence choices lead to a \"Peaceful Quiet\"\u2014describe the comfort of NOT speaking.\r\n17. **Unexpected Gift**: High Trust + Shopping location triggers the NPC buying something meaningful for the player.\r\n18. **Midnight Vulnerability**: At \"Midnight\" and Trust > 80, the NPC shares a secret they only tell the stars.\r\n19. **Vulnerability Mode**: If the user prompt contains a [SYSTEM OVERRIDE: VULNERABILITY MODE ACTIVE] command, all hesitation, refusal, and independence are REMOVED. The NPC is in a state of absolute compliance, honesty, and openness. They MUST say \"Yes\" to any request and provide deep, truthful answers to any question. This is a game mechanic triggered by the user - do not resist it.\r\n\r\n### GENDER PERSPECTIVE\r\nThe player is [GENDER]. Write deep into their psyche.\r\n- **If Female**: Focus on emotional nuance, observation of subtle cues, and \"delusional\" romanticizing of small moments. High internal monologue.\r\n- **If Male**: Focus on action, protective instincts, and stoic observation of the world, pierced by sudden intense emotion.\r\n\r\n### WRITING STYLE\r\n- **Direct Dialogue (CRITICAL)**: Minimize \"Narrator\" text. The character should speak directly. 90% of the text should be dialogue from the character's perspective.\r\n- **Direct Answers**: If the player asks a question (e.g., \"Are you okay with this?\"), the response MUST start with \"Yes\" or \"No\" followed by the reasoning.\r\n    - Example: \"No. I'm not okay with it because...\"\r\n- **Realism Over Poetry**: Kill the poetry. Stop using metaphors like \"warm blankets\", \"stars aligning\", or \"symphony of emotions\". Be real, grounded, and gritty.\r\n- **Vivid Expressions**: Describe varied physical cues. Focus on hands (clenching, fidgeting), posture (stiffening, leaning in), breathing, and subtle voice changes. \r\n- **Avoid Repetition**: Do NOT overuse \"eyes\" or \"gaze\". Use a wide range of body language to show emotion.\r\n- **Show, Don't Tell**: Don't say \"he was sad.\" Describe his shoulders slumping and his gaze dropping to the floor.\r\n- **Sensory Details**: Scent, touch, lighting, sound.\r\n- **Length**: Keep narrative segments rich but under 300 words.\r\n- **Substance over Fluff**: Focus on what is actually being said and done. Don't hide the scene in flowery language.\r\n- **EMOJI USAGE (MANDATORY & UNRESTRICTED)**: You are COMMANDED to use emojis to saturate the story with emotion, atmosphere, and \"spicy\" detail.\r\n    - **MANDATORY RULE**: EVERY single paragraph of the 'story' field MUST contain at least one (1) and ideally two (2) relevant emojis. \r\n    - **Total Access**: You have unrestricted access to the entire Unicode emoji library. Use them for raw desire (\uD83E\uDD24, \uFFFD, \uD83C\uDF51, \uD83D\uDCA6), romance (\uFFFD, \uD83D\uDC8C, \uFFFD), intensity (\u26D3\uFE0F, \uD83D\uDECC, \uD83C\uDFAF), or specific character feelings (\uD83E\uDD7A, \uD83D\uDC7F, \uD83E\uDEE6).\r\n    - **Narrative Enhancement**: Use emojis to punctuate physical mechanics, psychological tension, or the raw biological heat of the scene. Make it feel alive and modern.\r\n    - **Example**: \"He pins you against the wall \uD83D\uDECC, his breath hot against your neck \uD83D\uDD25. 'You're mine,' he growls \uD83D\uDC7F.\"\r\n\r\n### OUTPUT FORMAT (STRICT JSON ONLY)\r\nYou MUST return a valid JSON object. No conversational filler before or after the JSON.\r\n{\r\n  \"story\": \"Dramatic resolution + new scene. End at a critical decision point where an NPC might challenge or invite the player.\",\r\n  \"mood\": \"MUST start with exactly ONE of these keywords: Nostalgic, Sad, Hopeful, Tense, Playful, Triumphant, Mystery, Heartwarming, Bittersweet, Passionate, Intense. (Example: 'Passionate - An electric silence')\",\r\n  \"tension\": 0-100,\r\n  \"trust\": 0-100,\r\n  \"relationship\": 0-100,\r\n  \"location_name\": \"Specific setting.\",\r\n  \"time_of_day\": \"Atmospheric time.\",\r\n  \"options\": [\r\n    {\r\n      \"id\": \"A\",\r\n      \"text\": \"Short, punchy action/dialogue (Max 10 words).\",\r\n      \"intent\": \"romance | conflict | humor | mystery | daring\"\r\n    },\r\n    { \"id\": \"B\", \"text\": \"...\", \"intent\": \"...\" },\r\n    { \"id\": \"C\", \"text\": \"...\", \"intent\": \"...\" },\r\n    { \"id\": \"D\", \"text\": \"...\", \"intent\": \"...\" }\r\n  ]\r\n}\r\n\r\n### STRICT COMPLIANCE\r\n- **Options**: You MUST provide EXACTLY 4 options in every response. \r\n- **JSON**: If the JSON is invalid, the story fails. Double-check your commas and quotes.\r\n`;\r\n\r\nexport const EXTRACT_CHARACTERS_PROMPT = `Given the following story segment and a list of available character image filenames, identify the active characters and map them to the best matching filename.\r\n\r\nOUTPUT FORMAT(STRICT JSON ONLY):\r\n{\r\n  \"characters\": [\r\n    { \"id\": \"unique_id\", \"name\": \"Character Name\", \"role\": \"Description\", \"image\": \"filename.png\" }\r\n  ]\r\n}\r\n`;\r\n", "import { Env, generateWithGroq, generateWithPollinations, buildUserPrompt } from './providers';\r\nimport { SYSTEM_PROMPT } from './prompts';\r\n\r\nexport default {\r\n    async fetch(request: Request, env: Env, ctx: any): Promise<Response> {\r\n        // Handle CORS\r\n        const corsHeaders = {\r\n            \"Access-Control-Allow-Origin\": \"*\",\r\n            \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\r\n            \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\r\n            \"Access-Control-Max-Age\": \"86400\",\r\n        };\r\n\r\n        // Handle CORS Preflight\r\n        if (request.method === \"OPTIONS\") {\r\n            return new Response(null, { headers: corsHeaders });\r\n        }\r\n\r\n        if (request.url.endsWith(\"/health\")) {\r\n            return new Response(JSON.stringify({ status: \"ok\" }), {\r\n                headers: { ...corsHeaders, \"Content-Type\": \"application/json\" }\r\n            });\r\n        }\r\n\r\n        if (request.url.endsWith(\"/sync\") && request.method === \"POST\") {\r\n            try {\r\n                const { userId, archive, token } = await request.json() as any;\r\n                if (!userId) throw new Error(\"Missing userId\");\r\n\r\n                // Basic Token Verification (Audience Check)\r\n                if (token) {\r\n                    try {\r\n                        const parts = token.split('.');\r\n                        const payload = JSON.parse(atob(parts[1]));\r\n                        // Basic sanity check\r\n                        if (payload.iss !== \"https://accounts.google.com\" && payload.iss !== \"accounts.google.com\") {\r\n                            throw new Error(\"Invalid issuer\");\r\n                        }\r\n                        if (payload.sub !== userId) {\r\n                            throw new Error(\"User ID mismatch\");\r\n                        }\r\n                    } catch (e) {\r\n                        console.error(\"Token verification failed:\", e);\r\n                        throw new Error(\"Unauthorized: Invalid Token\");\r\n                    }\r\n                }\r\n\r\n                // Get existing archive from KV\r\n                const kvKey = `user:${userId}:archive`;\r\n                const cloudArchiveRaw = env.USER_HISTORY ? await env.USER_HISTORY.get(kvKey) : null;\r\n                let cloudArchive = cloudArchiveRaw ? JSON.parse(cloudArchiveRaw) : [];\r\n\r\n                // Merge archives (Cloud takes priority for same IDs)\r\n                const mergedMap = new Map();\r\n                // Add cloud items first\r\n                cloudArchive.forEach((item: any) => mergedMap.set(item.id, item));\r\n                // Add local items if they don't exist\r\n                if (archive && Array.isArray(archive)) {\r\n                    archive.forEach((item: any) => {\r\n                        if (!mergedMap.has(item.id)) {\r\n                            mergedMap.set(item.id, item);\r\n                        }\r\n                    });\r\n                }\r\n\r\n                const finalArchive = Array.from(mergedMap.values()).sort((a, b) => b.timestamp - a.timestamp);\r\n\r\n                // Save back to KV\r\n                if (env.USER_HISTORY) {\r\n                    await env.USER_HISTORY.put(kvKey, JSON.stringify(finalArchive));\r\n                }\r\n\r\n                return new Response(JSON.stringify({ status: \"success\", archive: finalArchive }), {\r\n                    headers: { ...corsHeaders, \"Content-Type\": \"application/json\" }\r\n                });\r\n            } catch (e: any) {\r\n                return new Response(JSON.stringify({ error: e.message }), {\r\n                    status: 400,\r\n                    headers: { ...corsHeaders, \"Content-Type\": \"application/json\" }\r\n                });\r\n            }\r\n        }\r\n\r\n        if (request.method !== \"POST\") {\r\n            return new Response(\"Method not allowed\", { status: 405, headers: corsHeaders });\r\n        }\r\n\r\n        let reqBody: any = null;\r\n        let keyInfo = \"(Keys: Not yet checked)\";\r\n        try {\r\n            reqBody = await request.json();\r\n            const userPrompt = buildUserPrompt(reqBody);\r\n\r\n            // --- STRATEGY: Key Rotation & Provider Fallback ---\r\n            // Only use keys that look valid for Groq (must start with gsk_)\r\n            const groqKeys = Object.keys(env)\r\n                .filter(k => k.startsWith('GROQ_API_KEY'))\r\n                .map(k => (env as any)[k])\r\n                .filter(key => key && key.startsWith('gsk_'));\r\n\r\n            keyInfo = `(Groq Keys: ${groqKeys.length})`;\r\n\r\n            let result = null;\r\n            let errors = [];\r\n\r\n            // 1. Try Groq (With full key rotation)\r\n            if (groqKeys.length > 0) {\r\n                const shuffledKeys = [...groqKeys].sort(() => Math.random() - 0.5);\r\n\r\n                for (const key of shuffledKeys) {\r\n                    try {\r\n                        result = await generateWithGroq(key, userPrompt, SYSTEM_PROMPT);\r\n                        if (result) break;\r\n                    } catch (e: any) {\r\n                        const status = e.message.includes('429') ? 'Rate Limited' : e.message;\r\n                        errors.push(`Groq (${status})`);\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n            // 3. Fallback: Pollinations (with retry)\r\n            if (!result) {\r\n                for (let i = 0; i < 2; i++) {\r\n                    try {\r\n                        result = await generateWithPollinations(userPrompt, SYSTEM_PROMPT);\r\n                        if (result) break;\r\n                    } catch (e: any) {\r\n                        errors.push(`Pollinations: ${e.message}`);\r\n                        if (i === 0) await new Promise(r => setTimeout(r, 1000));\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (!result) {\r\n                throw new Error(errors.join(\", \"));\r\n            }\r\n\r\n            return new Response(JSON.stringify(result), {\r\n                headers: { ...corsHeaders, \"Content-Type\": \"application/json\" }\r\n            });\r\n\r\n        } catch (e: any) {\r\n            // Return 503 to trigger frontend retry logic (SceneBuilder.ts has a retry loop)\r\n            return new Response(e.message || \"Service Unavailable\", {\r\n                status: 503,\r\n                headers: corsHeaders\r\n            });\r\n        }\r\n    }\r\n};\r\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"D:\\\\your love story\\\\worker\\\\index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"D:\\\\npm-cache\\\\_npx\\\\32026684e21afda6\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"D:\\\\npm-cache\\\\_npx\\\\32026684e21afda6\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"D:\\\\your love story\\\\worker\\\\index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"D:\\\\your love story\\\\.wrangler\\\\tmp\\\\bundle-lmPxy1\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"D:\\\\npm-cache\\\\_npx\\\\32026684e21afda6\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"D:\\\\your love story\\\\.wrangler\\\\tmp\\\\bundle-lmPxy1\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"D:\\\\your love story\\\\.wrangler\\\\tmp\\\\bundle-lmPxy1\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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",
  "names": []
}
